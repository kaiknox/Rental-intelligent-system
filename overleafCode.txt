\documentclass[12pt, a4paper]{article}
\usepackage[spanish]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{geometry}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{caption}
\usepackage{subcaption}

\geometry{margin=2.5cm}

\definecolor{codebg}{rgb}{0.95,0.95,0.95}
\lstset{
    backgroundcolor=\color{codebg},
    basicstyle=\ttfamily\small,
    breaklines=true,
    frame=single,
    captionpos=b,
    showstringspaces=false
}

\title{Práctica de Sistemas Basados en el Conocimiento \\ Recomendación de Viviendas en Alquiler}
\author{Grupo XX \\ Nombres de los integrantes}
\date{\today}

\begin{document}

\maketitle

% ============================
% PRIMERA PARTE: PLANTEAMIENTO DEL PROBLEMA
% ============================
\section{Introducción y planteamiento del problema}
\label{sec:intro}

\subsection{Estructura del documento}
Este documento se organiza en tres partes principales, siguiendo las directrices de la rúbrica de evaluación:

\begin{itemize}
    \item \textbf{Parte 1 (Introducción)}: Planteamiento del problema, objetivos y metodología.
    \item \textbf{Parte 2 (Desarrollo)}: Conceptualización, formalización (ontología) e implementación en CLIPS.
    \item \textbf{Parte 3 (Resultados)}: Casos de prueba, análisis de resultados, conclusiones y trabajo en equipo.
\end{itemize}

\subsection{Contexto y motivación}
La práctica plantea el desarrollo de un sistema de recomendación de viviendas en alquiler que pueda ser utilizado por una entidad pública para ayudar a los ciudadanos a encontrar ofertas adecuadas a sus necesidades. 

El problema implica combinar dos tipos de información:
\begin{itemize}
    \item \textbf{Características de las viviendas}: precio, superficie, tipo de propiedad, amenities, ubicación, etc.
    \item \textbf{Perfil y preferencias del usuario}: presupuesto, composición familiar, necesidades de proximidad a servicios, restricciones, etc.
\end{itemize}

La complejidad del dominio y la necesidad de aplicar conocimiento experto para ponderar múltiples factores convierten este problema en un caso idóneo para un Sistema Basado en el Conocimiento (SBC).

\subsection{Objetivos de la práctica}
El objetivo principal de esta práctica es diseñar e implementar un \textbf{Sistema Basado en el Conocimiento (SBC)} que emule el razonamiento de un experto inmobiliario para recomendar viviendas en alquiler. Los objetivos específicos son:

\begin{itemize}
    \item Analizar el dominio del problema e identificar las fuentes de conocimiento necesarias.
    \item Construir una ontología formal que represente los conceptos clave: \textbf{viviendas}, \textbf{solicitantes}, \textbf{servicios urbanos} y \textbf{zonas de la ciudad}.
    \item Implementar en CLIPS un sistema de reglas que realice:
    \begin{itemize}
        \item Evaluación de compatibilidad entre perfil del solicitante y características de la vivienda.
        \item Cálculo de proximidad a servicios relevantes (transporte, educación, ocio, salud, etc.).
        \item Clasificación de las recomendaciones en tres categorías: \textit{parcialmente adecuada}, \textit{adecuada} y \textit{muy recomendable}.
    \end{itemize}
    \item Validar el sistema mediante casos de prueba representativos y documentar el proceso de desarrollo siguiendo la metodología de ingeniería del conocimiento.
\end{itemize}

\subsection{Metodología de desarrollo}
Para abordar este problema, se ha seguido la metodología de \textbf{Ingeniería del Conocimiento} explicada en clase, estructurada en las siguientes fases:

\begin{enumerate}
    \item \textbf{Identificación}: Análisis del enunciado, definición de objetivos y alcance.
    \item \textbf{Conceptualización}: Extracción y organización del conocimiento experto, identificación de conceptos y relaciones.
    \item \textbf{Formalización}: Construcción de la ontología en Protégé y diseño de la estrategia de razonamiento.
    \item \textbf{Implementación}: Codificación en CLIPS del sistema de reglas y hechos.
    \item \textbf{Prueba}: Validación mediante casos de prueba y análisis de resultados.
\end{enumerate}

% ============================
% SEGUNDA PARTE: DESARROLLO Y ELABORACIÓN DE LA SOLUCIÓN
% ============================
\section{Desarrollo de la solución}
\label{sec:desarrollo}

\subsection{Conceptualización}
\label{subsec:conceptualizacion}

\subsubsection{Extracción de conocimiento}
Si se usó modelo de lenguaje: contexto dado, preguntas realizadas, conocimiento extraído. Si no, explicar cómo se obtuvo el conocimiento (sentido común, investigación).

\subsubsection{Conceptos y relaciones principales}
A partir del análisis del dominio y de la experiencia en portales inmobiliarios, identificamos los siguientes conceptos clave, que posteriormente se formalizarán en la ontología:

\begin{itemize}
    \item \textbf{Cliente}: persona o grupo que busca vivienda. Se distingue entre:
    \begin{itemize}
        \item \textbf{Individual}: Adulto, Joven, Estudiante, Anciano.
        \item \textbf{Grupo}: Pareja (con o sin hijos previstos, joven o anciana), Familia (con o sin ancianos), Grupo de estudiantes.
    \end{itemize}
    
    \item \textbf{Vivienda}: oferta de alquiler. Incluye subtipos como:
    \begin{itemize}
        \item \textbf{Piso}, \textbf{Dúplex}, \textbf{Ático}, \textbf{Estudio}.
        \item \textbf{Casa individual}, \textbf{Casa pareada}, \textbf{Casa adosada}.
        \item \textbf{Habitación} para alquiler individual.
    \end{itemize}
    
    \item \textbf{Servicio}: elemento urbano que influye en la calidad de vida:
    \begin{itemize}
        \item \textbf{Transporte}: Parada de autobús, metro, tren, aparcamiento.
        \item \textbf{Educación}: Colegio, instituto, universidad.
        \item \textbf{Salud}: Clínica, hospital, farmacia.
        \item \textbf{Comercio}: Supermercado, hipermercado, centro comercial, tienda.
        \item \textbf{Ocio}: Parque, piscina, gimnasio, cine, museo, zona de vida nocturna, restaurante, playa, polideportivo.
    \end{itemize}
    
    \item \textbf{Zona}: área de la ciudad con características homogéneas:
    \begin{itemize}
        \item \textbf{Residencial}, \textbf{Centro}, \textbf{Núcleo urbano}, \textbf{Negocios}, \textbf{Industrial}.
    \end{itemize}
\end{itemize}

\paragraph{Relaciones principales identificadas:}
\begin{itemize}
    \item Una \textbf{Vivienda} \textit{está ubicada en} una \textbf{Zona} (relación \texttt{is\_located\_in\_zone}).
    \item Una \textbf{Vivienda} \textit{está cerca de} uno o más \textbf{Servicios} (relación \texttt{is\_near\_service}).
    \item Un \textbf{Cliente} \textit{tiene preferencias y restricciones} sobre:
    \begin{itemize}
        \item Precio máximo, flexibilidad presupuestaria, precio mínimo sospechoso (\textit{too bargain}).
        \item Número mínimo de dormitorios y baños.
        \item Necesidad de transporte público, posesión de coche.
        \item Ubicación de trabajo/estudio (coordenadas).
        \item Mascotas, ruido tolerado, características deseadas (terraza, ascensor, amueblado, etc.).
    \end{itemize}
    \item Una \textbf{Vivienda} \textit{puede satisfacer o no} dichas preferencias, lo que determina su \textbf{grado de recomendación} (parcialmente adecuada, adecuada, muy recomendable).
\end{itemize}

\subsubsection{Descomposición en subproblemas}
Explicar cómo se divide el problema global en tareas más pequeñas:
\begin{itemize}
    \item Subproblema 1: Captura de preferencias del usuario.
    \item Subproblema 2: Evaluación de viviendas respecto a preferencias.
    \item Subproblema 3: Cálculo de distancias a servicios.
    \item Subproblema 4: Clasificación y recomendación final.
\end{itemize}

\subsection{Formalización}
\label{subsec:formalizacion}


\subsubsection{Ontología del dominio}
La ontología se ha construido en Protégé siguiendo la metodología de desarrollo de ontologías 101, y está compuesta por 4 conceptos raíz principales, sus jerarquías de subclases, propiedades de objeto y datos, y restricciones de dominio/rango.

\paragraph{Jerarquía de clases}
\begin{itemize}
    \item \textbf{\texttt{Client\_Group}}: representa a los solicitantes. Se divide en:
    \begin{itemize}
        \item \textbf{\texttt{Individual}}: \texttt{Adult}, \texttt{Young}, \texttt{Student}, \texttt{Elderly}.
        \item \textbf{\texttt{Group}}: \texttt{Couple} (\texttt{Elderly\_Couple}, \texttt{Planning\_Kids}, \texttt{Young\_No\_Kids}), \texttt{Family} (\texttt{No\_Elderly}, \texttt{With\_Elderly}), \texttt{Student\_Group}.
    \end{itemize}
    Se ha modelado así para capturar perfiles con necesidades diferenciadas (ej: jóvenes buscan ocio, familias buscan escuelas).
    
    \item \textbf{\texttt{Property}}: representa las viviendas en alquiler. Incluye:
    \begin{itemize}
        \item Tipos urbanos: \texttt{Apartment}, \texttt{Duplex}, \texttt{Penthouse}, \texttt{Studio}, \texttt{Triplex}, \texttt{Room}.
        \item Tipos unifamiliares: \texttt{Detached\_House}, \texttt{Semidetached\_House}, \texttt{Row\_House}, \texttt{Single-family\_House}.
    \end{itemize}
    Se han definido como \textit{disjoint} para evitar inconsistencias.
    
    \item \textbf{\texttt{Service}}: modela los servicios urbanos. Subclases:
    \begin{itemize}
        \item \texttt{Transport} (\texttt{Bus\_stop}, \texttt{Metro\_station}, \texttt{Train\_station}, \texttt{Parking}, \texttt{Clable\_car\_station}).
        \item \texttt{Education} (\texttt{School}, \texttt{High\_School}, \texttt{University}).
        \item \texttt{Healthcare} (\texttt{Clinic}, \texttt{Hospital}, \texttt{Pharmacy}).
        \item \texttt{Shopping} (\texttt{Supermarket}, \texttt{Hipermarket}, \texttt{Mall}, \texttt{Store}).
        \item \texttt{Recreation} (\texttt{Park}, \texttt{Pool}, \texttt{Gym}, \texttt{Beach}, \texttt{Cinema}, \texttt{Museum}, \texttt{Nightlife}, etc.).
    \end{itemize}
    Esta categorización permite evaluar la proximidad a servicios de forma estructurada.
    
    \item \textbf{\texttt{Zone}}: describe zonas de la ciudad:
    \begin{itemize}
        \item \texttt{Residential}, \texttt{Business}, \texttt{Downtown}, \texttt{Industrial}, \texttt{Urban\_core}.
    \end{itemize}
    Cada zona tiene atributos como nivel de ruido y seguridad.
\end{itemize}

\paragraph{Propiedades de objeto}
\begin{itemize}
    \item \texttt{is\_located\_in\_zone}: relaciona una \texttt{Property} con una \texttt{Zone}. Es funcional (cada vivienda está en una sola zona).
    \item \texttt{is\_near\_service}: relaciona una \texttt{Property} con un \texttt{Service}. Permite modelar proximidad a múltiples servicios.
\end{itemize}

\paragraph{Propiedades de datos}
Se han agrupado en tres categorías para facilitar la modularidad:
\begin{itemize}
    \item \texttt{property\_attribute}: atributos de la vivienda (precio, metros², habitaciones, terraza, ascensor, amueblado, etc.).
    \item \texttt{client\_attribute}: atributos del solicitante (edad, presupuesto, preferencias, ubicación trabajo/estudio, etc.).
    \item \texttt{zone\_attribute}: atributos de la zona (nivel de ruido, seguridad).
\end{itemize}
Se han usado tipos de datos específicos (\texttt{boolean}, \texttt{int}, \texttt{float}) y enumerados (ej: \texttt{Sun\_Time}: \texttt{Morning}, \texttt{Afternoon}, \texttt{All\_Day}, \texttt{Never}).

\paragraph{Decisiones de diseño justificadas}
\begin{itemize}
    \item \textbf{Coordenadas enteras}: se usan \texttt{geo\_lat} y \texttt{geo\_long} como enteros para simplificar el cálculo de distancias en CLIPS.
    \item \texttt{floor\_level} solo aplica a \texttt{Apartment}, \texttt{Room} y \texttt{Studio}, no a viviendas unifamiliares.
    \item \texttt{Too\_Bargain}: se incluye como atributo del cliente para detectar precios sospechosamente bajos.
    \item \textit{Disjoint} entre clases: evita que una misma instancia sea, por ejemplo, un \texttt{Apartment} y una \texttt{Detached\_House}.
\end{itemize}

\subsubsection{Metodología de resolución de problemas}
Explicar qué metodología se ha elegido (p. ej., clasificación, razonamiento basado en casos) y cómo los subproblemas identificados encajan en ella.

\subsubsection{Diseño del Sistema de Reglas}
\label{subsubsec:diseno-reglas}

El sistema implementa tres tipos principales de reglas que permiten transformar los datos concretos del dominio en conocimiento abstracto para la toma de decisiones. Estas reglas siguen la metodología de resolución de problemas descrita anteriormente.

\paragraph{2.2.3.1 Reglas de Abstracción}
\label{par:reglas-abstraccion}

Estas reglas realizan la transición del \textbf{problema concreto} al \textbf{problema abstracto}, transformando datos brutos en atributos categóricos que permiten una evaluación sistemática. Se dividen en tres subtipos:

\textbf{Reglas de Abstracción Implícita:} La información ya se encuentra en formato abstracto cuando el usuario la proporciona. No se requiere procesamiento adicional.

\begin{itemize}
    \item \textbf{Ejemplo:} Cuando el usuario responde \textit{``¿Tiene coche propio?''} con \texttt{yes}, el sistema asigna directamente \texttt{yes} al atributo \texttt{owns\_car}.
    \item \textbf{Otros ejemplos:} \texttt{has\_pets}, \texttt{Budget\_Is\_Strict}, \texttt{Works\_In\_City}.
\end{itemize}

\textbf{Reglas de Abstracción Inducida:} Se infieren preferencias a partir de información demográfica, basándose en conocimiento experto sobre patrones comunes.

\begin{itemize}
    \item \textbf{Ejemplo:} Si el cliente es clasificado como \texttt{Elderly}, \texttt{Elderly\_Couple} o \texttt{With\_Elderly}, el sistema induce preferencias como \lstinline{"elevator"}, \lstinline{"quiet"}, \lstinline{"single-floor"}, \lstinline{"healthcare"}.
    \item Estas preferencias se añaden automáticamente a \texttt{desired\_features}.
\end{itemize}

\textbf{Reglas de Abstracción Explícita:} Transforman datos numéricos o geográficos en categorías simbólicas mediante fórmulas y umbrales predefinidos. Estas reglas realizan cálculos concretos que permiten evaluar características espaciales y cuantitativas de las propiedades.

\begin{itemize}
    \item \textbf{Cálculo de densidad de habitaciones (\texttt{room-density}):} 
    Para determinar si una propiedad tiene espacio suficiente para el grupo de clientes, el sistema calcula:
    \[
    \text{capacidad} = (\text{Num\_Double\_Rooms} \times 2) + \text{Num\_Single\_Rooms}
    \]
    \[
    \text{ratio} = \frac{\text{capacidad}}{\text{num\_people}}
    \]
    La clasificación resultante es:
    \begin{itemize}
        \item \texttt{saturated} (ratio < 1.0): insuficiente espacio
        \item \texttt{sufficient} (ratio = 1.0): espacio justo
        \item \texttt{spacious} (ratio > 1.0): espacio abundante
    \end{itemize}

    \item \textbf{Cálculo de distancias euclidianas:} 
    Todas las mediciones de proximidad se basan en la función \texttt{euclid-dist}, que calcula la distancia en línea recta entre dos puntos geográficos:
    \[
    \text{distancia}(x_1, y_1, x_2, y_2) = \sqrt{(x_1 - x_2)^2 + (y_1 - y_2)^2}
    \]
    Donde $(x_1, y_1)$ y $(x_2, y_2)$ son las coordenadas enteras de los puntos a comparar.

    \item \textbf{Asignación de servicios cercanos:} 
    Aplicando la función \texttt{euclid-dist}, el sistema clasifica la proximidad de cada servicio a una propiedad mediante dos reglas:
    \begin{itemize}
        \item \texttt{inicio-calcular-cercania}: servicio $\leq$ 200 m $\rightarrow$ \texttt{is\_near\_service}
        \item \texttt{inicio-calcular-media-cercania}: servicio entre 200-700 m $\rightarrow$ \texttt{is\_semi\_near\_service}
    \end{itemize}
    Estas reglas se ejecutan al inicio del sistema con prioridad alta (\texttt{salience 100} y \texttt{99}) para garantizar que todas las conexiones se establezcan antes del proceso de recomendación.

    \item \textbf{Cálculo de distancias a trabajo/estudio para grupos:} 
    Cuando múltiples personas trabajan o estudian en diferentes ubicaciones, el sistema implementa una estrategia conservadora considerando la \textbf{peor situación}. Para cada propiedad:
    
    \begin{enumerate}
        \item Se calcula la distancia entre la propiedad y cada ubicación de trabajo/estudio usando \texttt{euclid-dist}.
        \item Se determina la \textbf{distancia máxima} mediante la función \texttt{max-distance}, que itera sobre todas las coordenadas proporcionadas.
        \item Esta distancia máxima se clasifica según umbrales predefinidos:
        \begin{itemize}
            \item \texttt{< 1000 m} $\rightarrow$ \texttt{cerca}
            \item \texttt{1000–3500 m} $\rightarrow$ \texttt{media\_distancia}
            \item \texttt{> 3500 m} $\rightarrow$ \texttt{lejos}
        \end{itemize}
    \end{enumerate}
    
    \textbf{Justificación del diseño:} Esta aproximación garantiza que la recomendación sea válida para todos los miembros del grupo, incluso para quien tenga el trayecto más largo. Si la propiedad satisface la distancia máxima, automáticamente satisface las distancias menores de otros miembros.

    \item \textbf{Función de clasificación de distancias:} 
    La función auxiliar \texttt{classify-distance} encapsula la lógica de umbrales, permitiendo una modificación centralizada de los criterios de proximidad si fuera necesario en futuras versiones del sistema.
\end{itemize}

\paragraph{2.2.3.2 Reglas de Evaluación de Criterios}
\label{par:reglas-evaluacion}

Una vez obtenidos los atributos abstractos, el sistema evalúa cada propiedad contra los criterios del cliente. Estas reglas comparan características específicas y generan evaluaciones cualitativas.

\textbf{Ejemplos de criterios evaluados:}

\begin{itemize}
    \item \textbf{Compatibilidad presupuestaria:} Compara \texttt{monthly\_price} de la propiedad con \texttt{max\_budget} del cliente.
    \item \textbf{Compatibilidad con mascotas:} Verifica \texttt{Pets\_Allowed} de la propiedad contra \texttt{has\_pets} del cliente.
    \item \textbf{Densidad adecuada:} Evalúa \texttt{room-density} para determinar si hay suficiente espacio.
    \item \textbf{Distancia a servicios clave:} Comprueba proximidad a trabajo/estudio según categorías \texttt{cerca}, \texttt{media\_distancia}, \texttt{lejos}.
    \item \textbf{Satisfacción de características deseadas:} Para cada elemento en \texttt{desired\_features}, verifica si la propiedad lo cumple mediante la función \texttt{feature-satisfied}.
\end{itemize}

\textbf{Salida de estas reglas:} Cada propiedad recibe dos listas:
\begin{itemize}
    \item \texttt{met-criteria}: Criterios que satisface.
    \item \texttt{failed-criteria}: Criterios que no satisface.
    \item \texttt{extra-criteria}: Características adicionales positivas no solicitadas explícitamente.
\end{itemize}

\paragraph{2.2.3.3 Reglas de Clasificación y Recomendación}
\label{par:reglas-clasificacion}

Finalmente, el sistema clasifica cada propiedad en una de cuatro categorías de recomendación basándose en los resultados de la evaluación.

\textbf{Lógica de clasificación implementada:}

\begin{enumerate}
    \item \textbf{No recomendado:} Si la propiedad falla en más de 3 criterios esenciales.
    \item \textbf{Parcialmente adecuada:} Si falla en 1-3 criterios, pero satisface los esenciales.
    \item \textbf{Adecuada:} Si satisface todos los criterios sin características extras destacables.
    \item \textbf{Muy recomendable:} Si satisface todos los criterios y además tiene características extras valoradas (ej: estado excelente, parque cercano, terraza, piscina).
\end{enumerate}

\textbf{Estrategia de implementación:} La regla \texttt{classify-property} analiza las listas \texttt{failed-criteria} y \texttt{extra-criteria} para asignar la categoría final. Esta clasificación permite presentar al usuario un ranking cualitativo de las propiedades disponibles.

\textbf{Ejemplo de salida:}
\begin{verbatim}
Propiedad apt-101 -> muy-adecuado
  Pros: [entra-en-presupuesto, admite-mascotas, ...]
  Contras: ninguno
  Extras: [estado-excelente, parque-cerca]
\end{verbatim}

\subsection{Implementación en CLIPS}
\label{subsec:implementacion}

\subsubsection{Estructura del proyecto}
Organización de módulos, templates, hechos iniciales.

\subsubsection{Ejemplo de reglas clave}
Fragmentos de código comentados que ilustren el razonamiento.

\begin{lstlisting}[language=Lisp, caption=Ejemplo de regla en CLIPS]
(defrule evaluar-precio
    ?s <- (solicitante (precio-max ?pmax) (flexible ?flex))
    ?v <- (vivienda (precio ?p) (id ?id))
    (test (<= ?p ?pmax))
    =>
    (assert (candidata (id ?id) (motivo "Dentro de presupuesto"))))
\end{lstlisting}

\subsubsection{Desarrollo incremental}
Descripción de los prototipos desarrollados, evolución desde el primer prototipo funcional hasta la versión final.

% ============================
% TERCERA PARTE: RESULTADOS Y CONCLUSIONES
% ============================
\section{Resultados y validación}
\label{sec:resultados}

\subsection{Juegos de prueba}
Explicación de cómo se seleccionaron los casos: perfiles variados (estudiante, familia, pareja), casos límite, cobertura de funcionalidades.

\subsection{Ejecución de pruebas}
Tabla resumen con al menos 6 casos diferentes, mostrando:
\begin{itemize}
    \item Perfil de entrada.
    \item Viviendas recomendadas (adecuadas, parcialmente adecuadas, muy recomendables).
    \item Criterios incumplidos o características destacadas.
\end{itemize}

\begin{table}[h]
\centering
\caption{Ejemplo de casos de prueba}
\begin{tabular}{p{3cm}|p{3cm}|p{3cm}|p{3cm}}
\toprule
\textbf{Perfil} & \textbf{Vivienda} & \textbf{Grado} & \textbf{Observaciones} \\
\midrule
Estudiante, precio bajo & Atico céntrico & Parcial & Sin terraza \\
Familia con hijos & Dúplex con jardín & Muy recomendable & Cerca de colegio y parque \\
\bottomrule
\end{tabular}
\end{table}

\subsection{Análisis de resultados}
Explicación de por qué el sistema toma ciertas decisiones, ejemplos concretos basados en el conocimiento codificado.

\subsection{Conclusiones}
\label{subsec:conclusiones}

\subsubsection{Logros y dificultades}
Qué se ha conseguido, qué partes fueron más complejas, limitaciones del sistema.

\subsubsection{Trabajo en equipo}
Breve descripción de cómo se organizó el grupo, reuniones, reparto de tareas, uso de la planificación propuesta.

\subsubsection{Posibles mejoras}
Extensiones futuras: integración con datos reales de mapas, más factores de ponderación, interfaz gráfica.

% ============================
% ANEXOS
% ============================
\appendix
\section{Anexo A: Ontología completa}
Gráfico exportado desde Protégé con la jerarquía de clases y propiedades.

\section{Anexo B: Diálogo con modelo de lenguaje}
Si aplica: contexto usado, preguntas más relevantes y respuestas resumidas.

\section{Anexo C: Código fuente completo}
Listado completo del código CLIPS (o enlace al repositorio).

\end{document}